# ネットワーク経由でのカードリーダー使用設定

スマホでアプリを開き、別端末（PC）でカードリーダーを接続してカードを読み取る方法について説明します。

## セットアップ手順

### 1. PC側（カードリーダー接続端末）の設定

1. PCをスマホと同じWi-Fiネットワークに接続します
2. PCでバックエンドサーバーを起動します：
   ```bash
   npm run dev:server
   ```
3. サーバー起動時に、コンソールに以下のような表示が出ます：
   ```
   📡 アクセス可能なURL:
      ローカル: http://localhost:3001
      ネットワーク: http://192.168.1.100:3001
   ```
   ※ IPアドレス（例：`192.168.1.100`）は環境によって異なります

### 2. スマホ側の設定

#### 方法A: 自動検出（推奨）
スマホでアプリを開くと、自動的にPCのIPアドレスを検出して接続を試みます。
- スマホとPCが同じネットワークに接続されている必要があります

#### 方法B: 手動設定
1. スマホでアプリを開きます
2. PCのIPアドレスを確認します（サーバー起動時のコンソール表示を参照）
3. ブラウザのコンソール（開発者ツール）を開き、以下のコマンドを実行します：
   ```javascript
   localStorage.setItem('apiBaseUrl', 'http://192.168.1.100:3001');
   location.reload();
   ```
   ※ `192.168.1.100`は実際のPCのIPアドレスに置き換えてください

#### 方法C: 環境変数での設定（開発時）
`.env`ファイルを作成し、以下を追加します：
```
VITE_API_BASE_URL=http://192.168.1.100:3001
```

### 3. 使用方法

1. **PC側**: バックエンドサーバーが起動していることを確認
2. **スマホ側**: アプリを開き、ゲームを進行
3. **最終パズル**: 「おもいで」の文字を正しく並べ替える
4. **カード読み取り**: ICカードをPCに接続されたカードリーダーにかざす
5. **結果**: スマホのアプリに「脱出成功」が表示されます

## トラブルシューティング

### 接続できない場合

1. **ファイアウォールの確認**
   - PCのファイアウォールでポート3001が許可されているか確認
   - 必要に応じて、ポート3001を開く設定を行ってください

2. **ネットワークの確認**
   - スマホとPCが同じWi-Fiネットワークに接続されているか確認
   - PCのIPアドレスが正しいか確認

3. **CORSエラーの確認**
   - ブラウザのコンソールにCORSエラーが表示されていないか確認
   - バックエンドサーバーで`cors()`が設定されていることを確認

4. **サーバーの起動確認**
   - PC側でバックエンドサーバーが正常に起動しているか確認
   - サーバーログにエラーが表示されていないか確認

## セキュリティに関する注意

- この設定では、同じネットワーク内のすべてのデバイスからバックエンドサーバーにアクセス可能になります
- 信頼できるネットワーク（自宅やイベント会場のWi-Fiなど）でのみ使用してください
- 公衆Wi-Fiや信頼できないネットワークでは使用しないでください

## 参考

- バックエンドサーバーのデフォルトポート: `3001`
- フロントエンドサーバーのデフォルトポート: `3000`
