# ICカード設定ガイド

## 概要

このアプリでは、ユーザーIDとICカード番号を紐付けることで、複数の端末で個別に脱出成功を判定できます。

## IDとカード番号の紐付け方法

### 方法1: APIを使用して登録

バックエンドサーバーが起動している状態で、以下のAPIを呼び出してIDとカード番号を紐付けます。

```bash
curl -X POST http://localhost:3001/api/register-card \
  -H "Content-Type: application/json" \
  -d '{"userId": "ユーザーID", "cardId": "カード番号（16進数）"}'
```

例:
```bash
curl -X POST http://localhost:3001/api/register-card \
  -H "Content-Type: application/json" \
  -d '{"userId": "user001", "cardId": "0123456789abcdef"}'
```

### 方法2: カードを読み取って自動登録

1. ユーザーがログイン（例: ID = "user001"）
2. 最終謎を解いて「おもいで」の順序にする
3. ICカードをかざす
4. バックエンドサーバーのログでカード番号を確認
5. 上記のAPIを使用してIDとカード番号を紐付け

### 方法3: 管理画面を作成（オプション）

将来的に管理画面を作成して、ブラウザからIDとカード番号を紐付けることも可能です。

## 登録済みマッピングの確認

```bash
curl http://localhost:3001/api/card-mappings
```

## 動作フロー

1. ユーザーがログイン（IDを入力）
2. ゲームをプレイ
3. 最終謎で「おもいで」の順序にする
4. ICカードをかざす
5. バックエンドでIDとカード番号を照合
6. **一致した場合のみ**脱出成功モーダルを表示

## 注意事項

- 現在の実装では、マッピングはメモリ上で管理されています
- サーバーを再起動すると、マッピングは消去されます
- 本番環境では、データベースやファイルに保存することを推奨します

## トラブルシューティング

### カードが読み取れない場合

1. ICカードリーダーが正しく接続されているか確認
2. バックエンドサーバーが起動しているか確認
3. ブラウザのコンソールでエラーメッセージを確認

### カード番号が一致しない場合

1. カード番号が正しく登録されているか確認
2. ログインしているIDと登録時のIDが一致しているか確認
3. バックエンドサーバーのログでカード番号を確認
