# ICカードデータベース管理ガイド

## 概要

20枚のICカードの番号をデータベースに保存・管理する機能を実装しました。

## データベース

- **SQLite**を使用
- データベースファイル: `server/cards.db`
- 自動的にテーブルが作成されます

## カード管理画面へのアクセス

1. ログイン画面でIDに **`admin`** または **`管理`** を入力
2. カード管理画面が表示されます

## カードの登録手順

### 1. 管理画面にアクセス

- ID: `admin` または `管理` でログイン

### 2. カードを読み込む

1. 「メモ」欄にカードの識別情報を入力（例: "カード1"、"カード2"など）
2. 「📱 カードを読み込む」ボタンをクリック
3. ICカードをリーダーにかざす
4. カード番号が自動的にデータベースに保存されます

### 3. 登録済みカードの確認

- 管理画面下部に登録済みのカード一覧が表示されます
- カードID、カード番号、メモ、登録日時が表示されます
- 5秒ごとに自動更新されます

## APIエンドポイント

### カードを読み込んで保存
```bash
POST http://localhost:3001/api/save-card
Content-Type: application/json

{
  "notes": "カード1"  // 任意
}
```

### 登録済みカード一覧を取得
```bash
GET http://localhost:3001/api/cards
```

### IDとカード番号を紐付ける
```bash
POST http://localhost:3001/api/register-card
Content-Type: application/json

{
  "userId": "user001",
  "cardId": "0123456789abcdef"
}
```

### 登録済みマッピングを取得
```bash
GET http://localhost:3001/api/card-mappings
```

## データベース構造

### cards テーブル
- `id`: 主キー（自動採番）
- `card_id`: カード番号（16進数、ユニーク）
- `user_id`: ユーザーID（NULL可）
- `registered_at`: 登録日時
- `notes`: メモ（NULL可）

### user_card_mappings テーブル
- `id`: 主キー（自動採番）
- `user_id`: ユーザーID（ユニーク）
- `card_id`: カード番号
- `created_at`: 作成日時

## 20枚のカードを登録する手順

1. 管理画面にアクセス（ID: `admin`）
2. 1枚目のカードをかざす
   - メモ: "カード1"
   - 「カードを読み込む」をクリック
   - カードをかざす
3. 2枚目以降も同様に繰り返す
   - メモ: "カード2", "カード3", ... "カード20"
4. 登録済みカード一覧で確認
   - 20枚すべてが表示されていることを確認

## 注意事項

- データベースファイル（`server/cards.db`）は`.gitignore`に追加されています
- サーバーを再起動してもデータは保持されます
- 同じカード番号は重複登録できません
- カード番号は16進数の文字列として保存されます

## トラブルシューティング

### カードが読み取れない場合

1. ICカードリーダーが正しく接続されているか確認
2. バックエンドサーバーが起動しているか確認
3. カードがリーダーに正しくかざされているか確認

### データベースエラーが発生した場合

1. `server/cards.db`ファイルの権限を確認
2. サーバーを再起動
3. データベースファイルを削除して再作成（既存データは消去されます）
